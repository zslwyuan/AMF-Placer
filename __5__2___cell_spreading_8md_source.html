<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AMF-Placer: doc/pages/_5_2_CellSpreading.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AMF-Placer
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">An Open-Source Timing-driven Analytical Mixed-size FPGA Placer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('__5__2___cell_spreading_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">doc/pages/_5_2_CellSpreading.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="__5__2___cell_spreading_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;@page _5_2_CellSpreading Parallel Cell Spreading</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# Parallel Cell Spreading</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;For a specific region on FPGA, the available resources of various types are limited. Therefore, the instances should be spread from the regions where demand for resources is outrunning supply, to other regions, as rough legalization. </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;The fundamental cell spreading algorithm of AMF-Placer is based on widely adopted bi-partitioning rough legalization. The placer will find an overflowed bin, expand it into a corresponding larger window containing it, recursively partition the window, and spread the instances into bins in the window. </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;The important difference between AMF-Placer&#39;s cell spreading algorithms and the other ones in previous works are that: (1) AMF-Placer conducts efficient utilization-guided search of spreading windows; (2) AMF-Placer realizes the parallel partitioning-based cell spreading; (3) AMF-Placer needs to handle the spreading of macros; (4) AMF-Placer&#39;s forgetting-rate cell spreading depress the aggressive cell spreading when encountering the uneven cell distribution of general real-world applications.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;For source code details, please check the class: GeneralSpreader .</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;**Utilization-Guided Search of Spreading Windows**</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;To find a minimal rectangular window for spreading from an overflowed bin, some previous works conducted an enumeration search, which could be time-consuming, while some others expanded the window from the overflowed bin with a pre-determined expanding pattern, which might lead to unnecessary window expanding and undermine wirelength. In contrast, AMF-Placer will iteratively expand the window. For each expanding iteration, it will first check the resource utilization of the neighbor bins in four directions. Then, to expand the window, it will select the direction, where the neighbor bins have the lowest utilization compared to the other directions. This iterative procedure for an overflowed bin will continue until the window covers enough resource. </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;&lt;center&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;&lt;img src=&quot;smartWindow.png&quot; alt=&quot;Utilization-Guided Search of Spreading Windows&quot; title=&quot;Utilization-Guided Search of Spreading Windows&quot; width=&quot;600&quot; /&gt; </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;&lt;/center&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;**Parallelized Cell Spreading of Mixed-size Elements**</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;To enable parallelized cell spreading, AMF-Placer will sort the overflowed bins according to their resource utilization. Those bins with higher utilization will have higher priority to find their spreading regions. During the speading window expanding for an overflowed bin, the bins in the window will be colored. The later window expanding for the other overflowed bins cannot cover the colored bins. The obtained windows will not overlap with each others and can conduct standard-cell-level spreading concurrently, as an example shown below.</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;&lt;center&gt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;&lt;img src=&quot;parallelSpreading.png&quot; alt=&quot;Parallel Spreading&quot; title=&quot;Parallel Spreading&quot; width=&quot;400&quot; /&gt; </div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;&lt;/center&gt;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;For a rectangular cell spreading window for an overflowed bin with sufficient resources, previous solutions required it to completely cover the macros inside it, which will lead to over-spreading and high HPWL when there are many large macros close to each other. For an extreame example, in order to resolve an overflowed bin, all the instances need to be spread over the entire device. </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;To solve this problem, as inspired by ASIC mixed-size placers, AMF-Placer conducts two-phase cell spreading:</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;1. In the first phase, standard cells in macros will be released from the shape constraints and spread with the other common standard cells to resolve the resource overflow.</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;2. In the second phase, a macro&#39;s location will be updated to the average location of the standard cells in it.</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;By iteratively involving the two phases, resource overflows will be gradually resolved. </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;**Forgetting-rate Based Cell Spreading and Constraints to Solve the Sensitivity**</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;The partitioning-based cell spreading algorithm is sensitive to the overflow. When a placement is compact, a single overflowed bin could cause cell spreading in a large region (or even the whole device) and seriously increase wirelength. Therefore, instead of directly updating instance location, we keep the location of an instance in last upper-bound placement as *L*. During cell spreading, when the instance is expected to spread to the location  *L&#39;* according to cell spreading result, the actual updated location will be set to: (f*L&#39;*+(1-f)\**L*), where f is forgetting rate and set according to the convergence stage. It can gradually depress the sensitivity of cell spreading as the placement tends to converge. An example is shown below in the figure.</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;Furthermore, to avoid significant disturbance to the placement when it is close to final convergence, AMF-Placer will limit the size of the cell spreading windows in the late placement procedure to constrain the movement of elements in one cell spreading iteration. </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;&lt;center&gt;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;&lt;img src=&quot;forgetRate.png&quot; alt=&quot;Forgetting-rate Based Cell Spreading&quot; title=&quot;Forgetting-rate Based Cell Spreading&quot; width=&quot;600&quot; /&gt; </div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;&lt;/center&gt;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;**Macro Spreading Deadlock Solution**</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;As shown in the figure below, macros might cause deadlocks in the common partitioning-based cell spreading algorithm because moving a macro spanning multiple bins from an overflowed region might cause new overflows in other regions. AMF-Placer&#39;s solution is to inject resource fluctuation to those bins trapped in deadlocks, i.e., periodically reduce and recover the resource supply of those bins, and squeeze out some instances from them. The extent of supply fluctuation for a bin is proportional to the number of times the bin gets overflowed. The fluctuation will stop immediately when there is no overflow.</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;&lt;center&gt;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;&lt;img src=&quot;Deadlock.png&quot; alt=&quot;Macro Spreading Deadlock Solution&quot; title=&quot;Macro Spreading Deadlock Solution&quot; width=&quot;400&quot; /&gt; </div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;&lt;/center&gt;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;References:</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;\[1\] Chak-Wa Pui et al., &quot;RippleFPGA: A routability-driven placement for large-scale heterogeneous FPGAs,&quot; 2016 IEEE/ACM International Conference on Computer-Aided Design (ICCAD), 2016, pp. 1-8, doi: 10.1145/2966986.2980084.</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;\[2\] Myung-Chul Kim et al. &quot;ComPLx: A Competitive Primal-dual Lagrange Optimization for Global Placement,&quot; 2012 the 49th Annual Design Automation Conference (DAC &#39;12), 2012, New York, NY, USA, 747–752.</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  </div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="__5__2___cell_spreading_8md.html">_5_2_CellSpreading.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
