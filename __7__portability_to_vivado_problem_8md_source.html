<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AMF-Placer: doc/pages/_7_portabilityToVivadoProblem.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AMF-Placer
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">An Open-Source Timing-driven Analytical Mixed-size FPGA Placer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('__7__portability_to_vivado_problem_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">doc/pages/_7_portabilityToVivadoProblem.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="__7__portability_to_vivado_problem_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Existing Problems When Exporting To Vivado {#_7_portabilityToVivadoProblem}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Some users might want to use our AMF-Placer as the bridge between their proposed implementation and Vivado. Since the detailed implementation of Vivado is unclear for us and AMF-Placer is still under development for many practical demands, we want users to know our current problems/limitations without being trapped during their implementation/experiment.</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Below are some problems/potential causes that we have found:</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;**1. The implementation of Vivado Shape Builder which generate macros is unclear for us**</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;1. We might sometime fail to handle some FF-based macros for clock domain crossing. These are some Xilinx Primitives. In this situation, several FFs will be required to be placed in near sites in specific BEL locations but we fail to figure out the implicit rules behind this situation;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;2. We might fail to handle some small LUTRAMs macros since it seems that Vivado pre-implementation optimization might fix the order of LUTRAMs in one SLICEM CLB which we fail to disable.</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;The walk-around solution is the same as the next situation.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;**2. The exact rules of Vivado FF packing is unclear for us:**</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;Alias nets are a bit confusing for our placer. In Vivado, nets might have their &quot;Alias&quot; names. It means that a physical net might have different names in different modules. This might cause problems in FF packing in CLB since in one FF control set, the CLK/Reset/Set/Preset signal should be the same. In our implementation, &quot;the same&quot; signal means one physical net, while in Vivado, it seems &quot;the same&quot; signal means that the name is the same. Below is an example, we try to packing the two FFs in benchmark &quot;MiniMap2&quot; into one control set but we fail. Their reset pins are connected to the same physical net but their pins require different alias names. We have submitted a report of this situation to Xilinx.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;```</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;place_cell {</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  design_1_i/xilinx_dma_pcie_ep_0/inst/xdma_0_i/inst/udma_wrapper/dma_top/dma_enable.vul_dma/WR/gen_rdwr_loop[0].gen_rdwr_eng.RDWR_INST/cfg_mrs_nn1_reg[13] SLICE_X107Y51/EFF</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  design_1_i/xilinx_dma_pcie_ep_0/inst/xdma_0_i/inst/udma_wrapper/dma_top/dma_enable.vul_dma/WR/gen_rdwr_loop[0].gen_rdwr_eng.RDWR_INST/cfg_mrs_nn1_reg[9] SLICE_X107Y51/FFF</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;}</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;ERROR: [Vivado 12-1409] Cannot set loc and bel property of instance(s) </div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;   to bel FFF. SET/RESET Difference</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;```</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;&lt;center&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;&lt;img src=&quot;aliasNet.png&quot; alt=&quot;Alias Nets&quot; title=&quot;Alias Nets&quot; width=&quot;800&quot; /&gt; </div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;&lt;/center&gt;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;The problems above might stop your loading of the generated Tcl file from AMF-Placer. We provide a script &quot;benchmarks/helperPythonScripts/removeFailurePartFromTcl.py&quot; for user as walk-around solution. Please copy the last target BEL location like the one highlighted in the screenshot below.</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;&lt;center&gt;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;&lt;img src=&quot;tclErrorExample.png&quot; alt=&quot;Packing Error Example&quot; title=&quot;Packing Error Example&quot; width=&quot;800&quot; /&gt; </div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;&lt;/center&gt;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;Then use the script to generate a new Tcl script which will continue the placement loading and bypassing the command cause the error. An example to use the script is shown below:</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;```</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;python removeFailurePartFromTcl.py  -i ./DumpCLBPacking-first-0.tcl -o ./new.tcl -e SLICE_X118Y51/FFF</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;```</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;**3. Fanout optimization of Vivado might cause commit failure during command &#39;place_design&#39;**</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;We find that Vivado placer will duplicate some elements during checking our placed elements for the optimization of high fanout signals. Sometime this will cause commit failure as shown below.</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;&lt;center&gt;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;&lt;img src=&quot;commitError.png&quot; alt=&quot;Commit Error Example&quot; title=&quot;Commit Error Example&quot; width=&quot;600&quot; /&gt; </div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;&lt;/center&gt;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;The problems above might stop your loading of the generated Tcl file from AMF-Placer. We provide a script &quot;benchmarks/helperPythonScripts/unplaceFailureCells.py&quot; for user as walk-around solution. Please copy the error message like those highlighed in red in the screenshot into a file. Then call the script to generate a  walk-around Tcl script which will unplace the involed cells and restart the P&amp;R procedure.</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;```</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;python unplaceFailureCells.py -i ./errors -o ./new.tcl</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;```</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;**4. The Log File for The Placement Errors**</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;Since we utilize &quot;catch&quot; to capture the errors in the placement Tcl script, some minor errors will not stop the placement loading. However, sometimes &quot;catch&quot; in Vivado Tcl might not work properly. Then, users can follow the instructions mentioned above to solve the problem.</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;For users&#39; assessment of the problems and potential impacts, we also dump the elements, which cannnot be placed by the script, in the same directory of the placement script (e.g., DumpCLBPacking-first-0.tcl). Please note that since AMF-Placer places elements in Vivado batch by batch to speed up the placement loading procedure, and each batch consists of about 5 elements, when one element cannot be placed, the entire batch (i.e., 5 elements) will be dumped in the error log file. </div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="__7__portability_to_vivado_problem_8md.html">_7_portabilityToVivadoProblem.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
