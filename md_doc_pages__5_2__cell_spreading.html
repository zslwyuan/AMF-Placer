<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AMF-Placer: Parallel Cell Spreading</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AMF-Placer<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">An Open-Source Analytical Mixed-size FPGA Placer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_pages__5_2__cell_spreading.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Parallel Cell Spreading </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="_5_2_CellSpreading"></a></p><h1>Parallel Cell Spreading</h1>
<p >For a specific region on FPGA, the available resources of various types are limited. Therefore, the instances should be spread from the regions where demand for resources is outrunning supply, to other regions, as rough legalization.</p>
<p >The fundamental cell spreading algorithm of AMF-Placer is based on widely adopted bi-partitioning rough legalization. The placer will find an overflowed bin, expand it into a corresponding larger window containing it, recursively partition the window, and spread the instances into bins in the window.</p>
<p >The important difference between AMF-Placer's cell spreading algorithms and the other ones in previous works are that: (1) AMF-Placer conducts efficient utilization-guided search of spreading windows; (2) AMF-Placer realizes the parallel partitioning-based cell spreading; (3) AMF-Placer needs to handle the spreading of macros; (4) AMF-Placer's forgetting-rate cell spreading depress the aggressive cell spreading when encountering the uneven cell distribution of general real-world applications.</p>
<p >For source code details, please check the class: <a class="el" href="class_general_spreader.html" title="GeneralSpreader accounts for the cell spreading, which controls the cell density of specific resource...">GeneralSpreader</a> .</p>
<p ><b>Utilization-Guided Search of Spreading Windows</b></p>
<p >To find a minimal rectangular window for spreading from an overflowed bin, some previous works conducted an enumeration search, which could be time-consuming, while some others expanded the window from the overflowed bin with a pre-determined expanding pattern, which might lead to unnecessary window expanding and undermine wirelength. In contrast, AMF-Placer will iteratively expand the window. For each expanding iteration, it will first check the resource utilization of the neighbor bins in four directions. Then, to expand the window, it will select the direction, where the neighbor bins have the lowest utilization compared to the other directions. This iterative procedure for an overflowed bin will continue until the window covers enough resource.</p>
<center> <img src="smartWindow.png" alt="Utilization-Guided Search of Spreading Windows" title="Utilization-Guided Search of Spreading Windows" width="600" class="inline"/> </center><p ><b>Parallelized Cell Spreading of Mixed-size Elements</b></p>
<p >To enable parallelized cell spreading, AMF-Placer will sort the overflowed bins according to their resource utilization. Those bins with higher utilization will have higher priority to find their spreading regions. During the speading window expanding for an overflowed bin, the bins in the window will be colored. The later window expanding for the other overflowed bins cannot cover the colored bins. The obtained windows will not overlap with each others and can conduct standard-cell-level spreading concurrently, as an example shown below.</p>
<center> <img src="parallelSpreading.png" alt="Parallel Spreading" title="Parallel Spreading" width="400" class="inline"/> </center><p >For a rectangular cell spreading window for an overflowed bin with sufficient resources, previous solutions required it to completely cover the macros inside it, which will lead to over-spreading and high HPWL when there are many large macros close to each other. For an extreame example, in order to resolve an overflowed bin, all the instances need to be spread over the entire device. To solve this problem, as inspired by ASIC mixed-size placers, AMF-Placer conducts two-phase cell spreading:</p>
<ol type="1">
<li>In the first phase, standard cells in macros will be released from the shape constraints and spread with the other common standard cells to resolve the resource overflow.</li>
<li>In the second phase, a macro's location will be updated to the average location of the standard cells in it.</li>
</ol>
<p >By iteratively involving the two phases, resource overflows will be gradually resolved.</p>
<p ><b>Forgetting-rate Based Cell Spreading and Constraints to Solve the Sensitivity</b></p>
<p >The partitioning-based cell spreading algorithm is sensitive to the overflow. When a placement is compact, a single overflowed bin could cause cell spreading in a large region (or even the whole device) and seriously increase wirelength. Therefore, instead of directly updating instance location, we keep the location of an instance in last upper-bound placement as <em>L</em>. During cell spreading, when the instance is expected to spread to the location <em>L'</em> according to cell spreading result, the actual updated location will be set to: (f*L'<em>+(1-f)**L</em>), where f is forgetting rate and set according to the convergence stage. It can gradually depress the sensitivity of cell spreading as the placement tends to converge. An example is shown below in the figure.</p>
<p >Furthermore, to avoid significant disturbance to the placement when it is close to final convergence, AMF-Placer will limit the size of the cell spreading windows in the late placement procedure to constrain the movement of elements in one cell spreading iteration.</p>
<center> <img src="forgetRate.png" alt="Forgetting-rate Based Cell Spreading" title="Forgetting-rate Based Cell Spreading" width="600" class="inline"/> </center><p ><b>Macro Spreading Deadlock Solution</b></p>
<p >As shown in the figure below, macros might cause deadlocks in the common partitioning-based cell spreading algorithm because moving a macro spanning multiple bins from an overflowed region might cause new overflows in other regions. AMF-Placer's solution is to inject resource fluctuation to those bins trapped in deadlocks, i.e., periodically reduce and recover the resource supply of those bins, and squeeze out some instances from them. The extent of supply fluctuation for a bin is proportional to the number of times the bin gets overflowed. The fluctuation will stop immediately when there is no overflow.</p>
<center> <img src="Deadlock.png" alt="Macro Spreading Deadlock Solution" title="Macro Spreading Deadlock Solution" width="400" class="inline"/> </center><p >References:</p>
<p >[1] Chak-Wa Pui et al., "RippleFPGA: A routability-driven placement for large-scale heterogeneous FPGAs," 2016 IEEE/ACM International Conference on Computer-Aided Design (ICCAD), 2016, pp. 1-8, doi: 10.1145/2966986.2980084.</p>
<p >[2] Myung-Chul Kim et al. "ComPLx: A Competitive Primal-dual Lagrange Optimization for Global Placement," 2012 the 49th Annual Design Automation Conference (DAC '12), 2012, New York, NY, USA, 747–752. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
